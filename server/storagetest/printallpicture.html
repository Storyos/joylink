<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Display Files from Supabase Storage</title>
  </head>
  <body>
    <!-- 이미지를 출력할 영역 -->
    <div id="image-container"></div>

    <!-- Supabase JS 클라이언트 라이브러리 불러오기 -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

    <script>
      // Supabase 프로젝트의 URL과 API 키
      const supabaseUrl = 'https://vtvkgtqvczyuteenfadw.supabase.co';
      const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ0dmtndHF2Y3p5dXRlZW5mYWR3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTIyNzUxNDksImV4cCI6MjAyNzg1MTE0OX0.jepRIWNY3wZaaDK9vkRubvol5y9VuhzoPU1CNnuACQo';

      // Supabase 클라이언트 생성
      const supabase = createClient(supabaseUrl, supabaseKey);

      // Supabase Storage에서 모든 파일을 가져와 화면에 출력하는 함수
      async function displayAllFilesFromStorage() {
        try {
          // Supabase Storage에서 모든 파일 목록 가져오기
          const { data: files, error } = await supabase.storage.from('testimg').list();

          if (error) {
            throw error;
          }

          // 이미지를 출력할 영역 가져오기
          const imageContainer = document.getElementById('image-container');

          // 각 파일에 대해 이미지 요소를 생성하고 출력
          files.forEach(async (file) => {
            // 이미지 파일인지 확인
            if (file.metadata.mimetype.startsWith('image')) {
              // 이미지 파일의 URL 생성
              const imageUrl = `${supabaseUrl}/storage/v1/object/${file.bucket}/${file.name}`;

              // 이미지를 가져와서 Blob으로 변환
              const response = await fetch(imageUrl);
              const blob = await response.blob();

              // Blob을 URL로 변환하여 이미지를 표시
              const objectURL = URL.createObjectURL(blob);

              // 이미지 요소 생성
              const imageElement = document.createElement('img');

              // 이미지의 URL 설정
              imageElement.src = objectURL;

              // 이미지를 출력할 영역에 이미지 요소 추가
              imageContainer.appendChild(imageElement);
            }
          });
        } catch (error) {
          console.error('Error fetching and displaying files:', error.message);
        }
      }

      // 페이지 로드 시 이미지 출력 함수 호출
      displayAllFilesFromStorage();
    </script>
  </body>
</html>
