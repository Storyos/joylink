<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Display Text Files from Supabase Storage</title>
  </head>
  <body>
    <!-- 텍스트를 출력할 영역 -->
    <div id="text-container"></div>

    <script>
      // Supabase Storage에서 모든 텍스트 파일을 가져와 화면에 출력하는 함수
      async function displayTextFilesFromStorage() {
        // 가져올 파일들이 저장된 버킷 이름
        const bucketName = 'Club1_BOard';
        
        // Supabase Storage의 파일 목록을 가져오기 위한 URL
        const fileListURL = `https://vtvkgtqvczyuteenfadw.supabase.co/storage/v1/object/${bucketName}/?metadata=true`;

        // 파일 목록을 가져옴
        const response = await fetch(fileListURL);
        const fileList = await response.json();

        // 텍스트 파일을 담을 배열
        const textFiles = [];

        // 파일 목록에서 텍스트 파일만 필터링하여 배열에 추가
        fileList.forEach(file => {
          if (file.metadata.contentType === 'text/plain') {
            textFiles.push(file);
          }
        });

        // 텍스트를 출력할 영역 가져오기
        const textContainer = document.getElementById('text-container');

        // 각 텍스트 파일에 대해 반복하여 텍스트를 화면에 출력
        textFiles.forEach(async file => {
          // 텍스트 파일의 URL
          const fileURL = file.url;

          // 텍스트 파일 내용 가져오기
          const response = await fetch(fileURL);
          const text = await response.text();

          // 텍스트를 출력할 요소 생성
          const textElement = document.createElement('pre');

          // 텍스트 설정
          textElement.textContent = text;

          // 텍스트를 출력할 영역에 추가
          textContainer.appendChild(textElement);
        });
      }

      // 페이지 로드 시 텍스트 파일 출력 함수 호출
      displayTextFilesFromStorage();
    </script>
  </body>
</html>
